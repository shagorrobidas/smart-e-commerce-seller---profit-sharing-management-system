<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Tasks - Staff</title>
    <link rel="stylesheet" href="../../css/style.css">
    <link rel="stylesheet" href="../../css/dashboard.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
</head>

<body class="dashboard-body">

    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="sidebar-header">
            <div
                style="width: 24px; height: 24px; background: linear-gradient(to top right, var(--primary), var(--accent-purple)); border-radius: 4px; display: flex; align-items: center; justify-content: center; color: white;">
                S</div>
            <span style="font-weight: 500;">Staff Portal</span>
        </div>
        <nav class="sidebar-nav">
            <a href="dashboard.html" class="nav-item"><iconify-icon icon="solar:widget-linear"></iconify-icon>
                Operations</a>
            <a href="inventory.html" class="nav-item"><iconify-icon icon="solar:box-minimalistic-linear"></iconify-icon>
                Inventory</a>
            <a href="orders.html" class="nav-item"><iconify-icon icon="solar:bag-check-linear"></iconify-icon>
                Orders</a>
            <a href="tasks.html" class="nav-item active"><iconify-icon
                    icon="solar:checklist-minimalistic-linear"></iconify-icon> Tasks</a>
            <a href="messages.html" class="nav-item"><iconify-icon icon="solar:chat-round-dots-linear"></iconify-icon>
                Messages</a>
            <a href="reports.html" class="nav-item"><iconify-icon icon="solar:file-text-linear"></iconify-icon> My
                Reports</a>
        </nav>
        <div class="user-profile">
            <a href="../../pages/profile.html"
                style="display: flex; gap: 0.75rem; text-decoration: none; align-items: center; flex: 1;">
                <div class="avatar" style="background: var(--accent-purple);">S</div>
                <div>
                    <p class="text-sm text-white">Staff</p>
                    <p class="text-xs text-muted">Operations</p>
                </div>
            </a>
            <button onclick="App.logout()"
                style="margin-left: auto; background: none; border: none; color: var(--text-muted); cursor: pointer;"><iconify-icon
                    icon="solar:logout-linear"></iconify-icon></button>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
        <header class="top-bar">
            <h1 class="page-title">My Tasks</h1>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <!-- Pending -->
            <div class="dashboard-form-card">
                <h3>To Do</h3>
                <div id="todo-list" style="margin-top: 1rem; display: flex; flex-direction: column; gap: 1rem;">
                    <!-- JS Populated -->
                </div>
            </div>

            <!-- Completed -->
            <div class="dashboard-form-card">
                <h3>Completed</h3>
                <div id="done-list" style="margin-top: 1rem; display: flex; flex-direction: column; gap: 1rem;">
                    <!-- JS Populated -->
                </div>
            </div>
        </div>
    </main>

    <script src="../../js/data-manager.js"></script>
    <script src="../../js/main.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const user = App.checkAuth();
            if (!user || user.role !== 'staff') window.location.href = '../../pages/login.html';

            const renderTasks = () => {
                const tasks = DB.getTasks().filter(t => t.assignedTo == user.id); // Loose equality for string/num mismatch
                const todoEl = document.getElementById('todo-list');
                const doneEl = document.getElementById('done-list');

                const todos = tasks.filter(t => t.status !== 'completed');
                const dones = tasks.filter(t => t.status === 'completed');

                todoEl.innerHTML = todos.length ? todos.map(t => createCard(t, false)).join('') : '<p class="text-muted text-sm">No pending tasks.</p>';
                doneEl.innerHTML = dones.length ? dones.map(t => createCard(t, true)).join('') : '<p class="text-muted text-sm">No completed tasks.</p>';
            };

            const createCard = (t, isDone) => `
                <div style="padding: 1rem; border: 1px solid var(--glass-border); border-radius: 8px; background: rgba(255,255,255,0.02);">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 0.5rem;">
                        <h4 style="margin:0; font-size: 0.9rem;">৳{t.title}</h4>
                        ৳{!isDone ? `< button onclick = "markDone(৳{t.id})" class="btn-xs" style = "background:var(--primary); color:white; border:none; padding:4px 8px; border-radius:4px; cursor:pointer;" > Mark Done</button > ` : '<iconify-icon icon="solar:check-circle-bold" style="color:var(--success)"></iconify-icon>'}
                    </div>
                    <p class="text-xs text-muted">৳{t.description || ''}</p>
                    <div style="margin-top: 0.5rem; font-size: 10px; color: var(--text-muted);">
                        Due: ৳{t.dueDate}
                    </div>
                </div>
            `;

            window.markDone = (id) => {
                DB.update('smartEcoTasks', id, { status: 'completed' });
                renderTasks();
            };

            renderTasks();
        });
    </script>
</body>

</html>